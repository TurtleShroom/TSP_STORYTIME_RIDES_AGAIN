<?xml version="1.0" encoding="utf-8" ?>

<!-- This code was provided by the user 'I Exist' -->

<Patch>

	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
	<xpath>/Defs/ThingDef[defName="VFE_Flour"]</xpath>
		<!-- If it does, LET'S FASTING GOOOOOOOOOO!!! -->
		<match Class="PatchOperationSequence">
			<success>Always</success>
			<operations>
				<li Class="PatchOperationAdd">
					<success>Always</success>
					<xpath>/Defs/RecipeDef/ingredients/li/filter/thingDefs/li[text()="VFE_Flour"]/..</xpath>
					<value>
						<li>GnomeFlour</li>
						<li MayRequire="Dajian.ChiTeaditional.Expanded">WorkedRawRice</li>
					</value>
				</li>
				
				<li Class="PatchOperationAdd">
					<success>Always</success>
					<xpath>/Defs/RecipeDef/fixedIngredientFilter/thingDefs/li[text()="VFE_Flour"]/..</xpath>
					<value>
						<li>GnomeFlour</li>
						<li MayRequire="Dajian.ChiTeaditional.Expanded">WorkedRawRice</li>
					</value>
				</li>
				
				<li Class="PatchOperationAdd">
					<success>Always</success>
					<xpath>/Defs/RecipeDef/fixedIngredientFilter/thingDefs/li[text()="VFE_RawSugar"]/..</xpath>
					<value>
						<li>ST_GnomeSugar</li>
					</value>
				</li>
				
				<li Class="PatchOperationAdd">
					<success>Always</success>
					<xpath>/Defs/RecipeDef/defaultIngredientFilter/thingDefs/li[text()="VFE_Flour"]/..</xpath>
					<value>
						<li>GnomeFlour</li>
						<li MayRequire="Dajian.ChiTeaditional.Expanded">WorkedRawRice</li>
					</value>
				</li>
				
				<li Class="PatchOperationAdd">
					<success>Always</success>
					<xpath>/Defs/RecipeDef/defaultIngredientFilter/thingDefs/li[text()="VFE_RawSugar"]/..</xpath>
					<value>
						<li>ST_GnomeSugar</li>
					</value>
				</li>
				
				<li Class="PatchOperationAdd">
					<success>Always</success>
					<xpath>/Defs/RecipeDef/fixedIngredientFilter/thingDefs/li[text()="VFE_RawSugar"]/..</xpath>
					<value>
						<li>ST_GnomeSugar</li>
					</value>
				</li>
				
				<li Class="PatchOperationAdd">
					<xpath>/Defs/RecipeDef/ingredients/li/filter/thingDefs/li[text()="VFE_Flour"]/..</xpath>
					<success>Always</success>
					<value>
						<li>GnomeFlour</li>
						<li MayRequire="Dajian.ChiTeaditional.Expanded">WorkedRawRice</li>
					</value>
				</li>
			</operations>
		</match>
	</Operation>

	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
	<xpath>/Defs/ThingDef[defName="VFE_Flour"]</xpath>
		<!-- If it does, insert this in the same nested statement as the destination. -->
		<match Class="PatchOperationInsert">
			<success>Always</success>
			<xpath>/Defs/RecipeDef/ingredients[li/filter/thingDefs/li="VFE_Flour"]/li</xpath> <!--  and (not (li/filter/thingDefs/li="GnomeFlour"))]/li -->
			<value>
				<li>GnomeFlour</li>
				<li MayRequire="Dajian.ChiTeaditional.Expanded">WorkedRawRice</li>
			</value>
		</match>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>

	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
	<xpath>/Defs/ThingDefDef[defName="VFE_RawSugar"]</xpath>
		<!-- If it does, insert this in the same nested statement as the destination. -->
		<match Class="PatchOperationInsert">
			<success>Always</success>
			<xpath>/Defs/RecipeDef/ingredients[li/filter/thingDefs/li="VFE_RawSugar"]/li</xpath> <!--  and (not (li/filter/thingDefs/li="ST_GnomeSugar"))]/li -->
			<value>
				<li>ST_GnomeSugar</li>
			</value>
		</match>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
	<xpath>/Defs/ThingDef[defName="VFE_Flour"]</xpath>
		<!-- If it does, insert this in the same nested statement as the destination. -->
		<match Class="PatchOperationInsert">
			<success>Always</success>
			<xpath>/Defs/RecipeDef/fixedIngredientFilter[thingDefs/li="VFE_Flour"]/li</xpath> <!--  and (not (li/filter/thingDefs/li="GnomeFlour"))]/li -->
			<value>
				<li>GnomeFlour</li>
				<li MayRequire="Dajian.ChiTeaditional.Expanded">WorkedRawRice</li>
			</value>
		</match>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
	<xpath>/Defs/ThingDef[defName="VFE_Flour"]</xpath>
		<!-- If it does, insert this in the same nested statement as the destination. -->
		<match Class="PatchOperationInsert">
			<success>Always</success>
			<xpath>/Defs/RecipeDef/defaultIngredientFilter[thingDefs/li="VFE_Flour"]/li</xpath> <!--  and (not (li/filter/thingDefs/li="GnomeFlour"))]/li -->
			<value>
				<li>GnomeFlour</li>
				<li MayRequire="Dajian.ChiTeaditional.Expanded">WorkedRawRice</li>
			</value>
		</match>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>

	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
	<xpath>/Defs/ThingDefDef[defName="VFE_RawSugar"]</xpath>
		<!-- If it does, insert this in the same nested statement as the destination. -->
		<match Class="PatchOperationInsert">
			<success>Always</success>
			<xpath>/Defs/RecipeDef/ingredients[li/filter/thingDefs/li="VFE_RawSugar"]/li</xpath> <!--  and (not (li/filter/thingDefs/li="ST_GnomeSugar"))]/li -->
			<value>
				<li>ST_GnomeSugar</li>
			</value>
		</match>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
	<xpath>/Defs/ThingDef[defName="VFE_Flour"]</xpath>
		<!-- If it does, insert this in the same nested statement as the destination. -->
		<match Class="PatchOperationInsert">
			<success>Always</success>
			<xpath>/Defs/RecipeDef/ingredients/li/filter/thingDefs/li[text()="VFE_Flour"]</xpath>
			<value>
				<li>GnomeFlour</li>
				<li MayRequire="Dajian.ChiTeaditional.Expanded">WorkedRawRice</li>
			</value>
		</match>
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
	<xpath>/Defs/ThingDef[defName="VFE_Flour"]</xpath>
		<!-- If it does, insert this in the same nested statement as the destination. -->
		<match Class="PatchOperationInsert">
			<success>Always</success>
			<xpath>/Defs/RecipeDef/fixedIngredientFilter/thingDefs/li[text()="VFE_Flour"]</xpath>
			<value>
				<li>GnomeFlour</li>
				<li MayRequire="Dajian.ChiTeaditional.Expanded">WorkedRawRice</li>
			</value>
		</match>
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
	<xpath>/Defs/ThingDef[defName="VFE_RawSugar"]</xpath>
		<!-- If it does, insert this in the same nested statement as the destination. -->
		<match Class="PatchOperationInsert">
			<success>Always</success>
			<xpath>/Defs/RecipeDef/ingredients/li/filter/thingDefs/li[text()="VFE_RawSugar"]</xpath>
			<value>
				<li>ST_GnomeSugar</li>
			</value>
		</match>
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
	<xpath>/Defs/ThingDef[defName="VFE_Flour"]</xpath>
		<!-- If it does, insert this in the same nested statement as the destination. -->
		<match Class="PatchOperationInsert">
			<success>Always</success>
			<xpath>/Defs/RecipeDef/fixedIngredientFilter/thingDefs/li[text()="VFE_RawSugar"]</xpath>
			<value>
				<li>ST_GnomeSugar</li>
			</value>
		</match>
	</Operation>
</Patch>

<!--Add or Insert depending on whether the node at the end is a parent or sibling-->

<!-- 
<Operation Class="PatchOperationAdd/Insert">
<xpath></xpath>
<value>
<li>GnomeFlour</li>
</value>
</Operation>

</Patch>
-->
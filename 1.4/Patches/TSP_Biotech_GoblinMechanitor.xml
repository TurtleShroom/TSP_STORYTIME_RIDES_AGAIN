<?xml version="1.0" encoding="utf-8" ?>

<Patch>
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
		<xpath>/Defs/HediffDef[defName="MechlinkImplant"]/techHediffsTags</xpath>
		<!-- If it does, add this. -->
		<match Class="PatchOperationAdd">
			<xpath>/Defs/HediffDef[defName="MechlinkImplant"]/techHediffsTags</xpath>
			<success>Always</success>
			<value>
				<li>Mechanitor</li>
			</value>
		</match>
		<!-- If it DOES NOT, add this instead. -->
		<nomatch Class="PatchOperationAdd" MayRequire="ludeon.rimworld.biotech">
			<xpath MayRequire="ludeon.rimworld.biotech">/Defs/HediffDef[defName="MechlinkImplant"]</xpath>
			<success MayRequire="ludeon.rimworld.biotech">Always</success>
			<value MayRequire="ludeon.rimworld.biotech">
				<techHediffsTags MayRequire="ludeon.rimworld.biotech">
					<li MayRequire="ludeon.rimworld.biotech">Mechanitor</li>
				</techHediffsTags>
			</value>
		</nomatch>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- DO THE GENTILES KNOW? -->
		<xpath>/Defs/HediffDef[defName="MechlinkImplant"]</xpath>
		<!-- If they do, SHUT IT DOWN. -->
		<match Class="PatchOperationRemove">
			<xpath>/Defs/HediffDef[defName="MechlinkImplant"]/removeOnRedressIfNotOfKind</xpath>
			<success>Always</success>
		</match>
		<!-- If the first XPATH does not exist, the original code stands. All according to plan. -->
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
		<xpath>/Defs/ScenarioDef[defName="Mechanitor"]</xpath>
		<!-- If it does, add this. -->
		<match Class="PatchOperationAdd">
			<xpath>/Defs/ScenarioDef[defName="Mechanitor"]/scenario/parts/li/kindCounts</xpath>
			<success>Always</success>
			<value>
				<li>
					<kindDef>GoblinGenius</kindDef>
					<count>2</count>
					<requiredAtStart>false</requiredAtStart>
				</li>
			</value>
		</match>
	</Operation>
</Patch>
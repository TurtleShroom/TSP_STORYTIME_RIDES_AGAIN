<?xml version="1.0" encoding="utf-8" ?>

<Patch>
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
		<xpath>/Defs/HediffDef[defName="MechlinkImplant"]/techHediffsTags</xpath>
		<!-- If it does, add this. -->
		<match Class="PatchOperationAdd">
			<xpath>/Defs/HediffDef[defName="MechlinkImplant"]/techHediffsTags</xpath>
			<success>Always</success>
			<value>
				<li>Mechanitor</li>
			</value>
		</match>
		<!-- If it DOES NOT, add this instead. -->
		<nomatch Class="PatchOperationAdd" MayRequire="ludeon.rimworld.biotech">
			<xpath MayRequire="ludeon.rimworld.biotech">/Defs/HediffDef[defName="MechlinkImplant"]</xpath>
			<success MayRequire="ludeon.rimworld.biotech">Always</success>
			<value MayRequire="ludeon.rimworld.biotech">
				<techHediffsTags MayRequire="ludeon.rimworld.biotech">
					<li MayRequire="ludeon.rimworld.biotech">Mechanitor</li>
				</techHediffsTags>
			</value>
		</nomatch>
		<!-- If the first XPATH does not exist, the original code stands. -->
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- DO THE GENTILES KNOW? -->
		<xpath>/Defs/HediffDef[defName="MechlinkImplant"]</xpath>
		<!-- If they do, SHUT IT DOWN. -->
		<match Class="PatchOperationRemove">
			<xpath>/Defs/HediffDef[defName="MechlinkImplant"]/removeOnRedressIfNotOfKind</xpath>
			<success>Always</success>
		</match>
		<!-- If the first XPATH does not exist, the original code stands. All according to plan. -->
	</Operation>
	
	<Operation Class="PatchOperationConditional">
	<!-- Does this exist? -->
		<xpath>/Defs/ScenarioDef[defName="Mechanitor"]</xpath>
		<!-- If it does, add this. -->
		<match Class="PatchOperationAdd">
			<xpath>/Defs/ScenarioDef[defName="Mechanitor"]/scenario/parts/li/kindCounts</xpath>
			<success>Always</success>
			<value>
				<li>
					<kindDef>GoblinGenius</kindDef>
					<count>2</count>
					<requiredAtStart>false</requiredAtStart>
				</li>
			</value>
		</match>
	</Operation>
	
	<Operation Class="PatchOperationConditional" MayRequire="ludeon.rimworld.biotech">
	<!-- Does this exist? -->
		<xpath>/Defs/HediffDef[defName="MechlinkImplant"]</xpath>
		<!-- If it does, add this. -->
		<match Class="PatchOperationAdd">
			<xpath>/Defs</xpath>
			<success>Always</success>
			<value>
			  <PawnKindDef ParentName="MechanitorBase" MayRequire="ludeon.rimworld.biotech">
				<defName MayRequire="ludeon.rimworld.biotech">GoblinGenius</defName>
				<label MayRequire="ludeon.rimworld.biotech">goblin elite</label>
				<combatPower MayRequire="ludeon.rimworld.biotech">170</combatPower>
				<factionLeader MayRequire="ludeon.rimworld.biotech">true</factionLeader>
				<defaultFactionType MayRequire="ludeon.rimworld.biotech">GoblinTown</defaultFactionType>
				<chemicalAddictionChance MayRequire="ludeon.rimworld.biotech">0.03</chemicalAddictionChance>
				<apparelMoney MayRequire="ludeon.rimworld.biotech">
				  <min>1250</min>
				  <max>3500</max>
				</apparelMoney>
				<apparelTags MayRequire="ludeon.rimworld.biotech">
					<li>IndustrialBasic</li>
					<li>IndustrialAdvanced</li>
					<li>IndustrialMilitary</li>
					<li>GoblinWear</li>
					<li>Cape</li>
				</apparelTags>
				<apparelRequired MayRequire="ludeon.rimworld.biotech" Inherit="False">
					<li MayRequire="vanillaexpanded.vappe">VAE_Apparel_LabCoat</li>
				</apparelRequired>
				<weaponMoney MayRequire="ludeon.rimworld.biotech">
					 <min>1200</min>
					 <max>2000</max>
				</weaponMoney>
				<backstoryCryptosleepCommonality MayRequire="ludeon.rimworld.biotech">0.054</backstoryCryptosleepCommonality>
				<techHediffsMoney MayRequire="ludeon.rimworld.biotech">
				  <min>1500</min>
				  <max>5000</max>
				</techHediffsMoney>
				<techHediffsTags MayRequire="ludeon.rimworld.biotech">
				  <li MayRequire="ludeon.rimworld.biotech">Mechanitor</li>
				</techHediffsTags>
				<techHediffsRequired MayRequire="ludeon.rimworld.biotech">
				  <li MayRequire="ludeon.rimworld.biotech">Mechlink</li>
				</techHediffsRequired>
				<biocodeWeaponChance>1</biocodeWeaponChance>
				<techHediffsChance>0.5</techHediffsChance>
				<weaponTags MayRequire="ludeon.rimworld.biotech">
					<li>GoblinTech</li>
					<li>GoblinAdvanced</li>
				</weaponTags>
				<initialWillRange>21~24</initialWillRange>
				<initialResistanceRange>48~101</initialResistanceRange>
				<skills MayRequire="ludeon.rimworld.biotech">
				  <li MayRequire="ludeon.rimworld.biotech">
					<skill>Intellectual</skill>
					<range>6~18</range>
				  </li>
				</skills>
			  </PawnKindDef>
			</value>
		</match>
	</Operation>
</Patch>